<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>BiS Comic</title>
</head>

<template name="layout">
	<div class="page-wrapper">
		<div class="container">
			{{> header}}
			{{> meteorErrors}}
			<div class="row">
				<div class="col-md-9">
					{{yield}}
				</div>
				<div class="col-md-3 side-panel">
					{{> sillyHighlight}}
					{{> newsFeed}}
				</div>
			</div>
		</div>
	</div>

	<div class="container footer">
		{{> footer}}
	</div>
</template>

<template name="footer">
	<div class="ui segment">
		<p class="item">dragons are smokin' hot</p>
	</div>
</template>

<template name="header">
	<div class="navbar navbar-default" role="navigation">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="{{pathFor 'home'}}">BiS Comic</a>
		</div>

		<div class="collapse navbar-collapse">
			<ul class="nav navbar-nav">
				<li class="{{active 'home'}}"><a href="{{pathFor 'home'}}">Latest</a></li>
				<li class="{{active 'archive'}}"><a href="{{pathFor 'archive'}}">Archive</a></li>
				<li class="{{active 'sillies'}}"><a href="/sillies">Sillies</a></li>
				<li class="{{active 'news'}}"><a href="{{pathFor 'news'}}">News</a></li>
				{{#if isAdmin}}
					<li class="{{active 'submit'}}"><a href="{{pathFor 'submit'}}">Submit</a></li>
					<li class="{{active 'edit'}}"><a href="{{pathFor 'edit'}}">Edit</a></li>
				{{/if}}
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li><a>{{loginButtons}}</a></li>
			</ul>
		</div>
	</div>
</template>

<template name="loading">
	{{> spinner}}
</template>

<template name="noLogin">
	<div class="alert alert-danger">Please log in.</div>
</template>

<template name="noAdmin">
	<div class="alert alert-danger">Your account cannot do this.</div>
</template>

<template name="notFound">
	<div class="alert alert-danger">Not found.</div>
</template>

<template name="noContent">
	<div class="alert alert-danger">There is no content.</div>
</template>

<template name="progressBar">
	{{#with getProgressFile}}
		{{#if cfsIsUploading "Images"}}
			<div class="progress">
				<div class="progress-bar" style='width: {{cfsQueueProgress "Images"}}%;'></div>
			</div>
		{{/if}}
	{{/with}}
</template>

<template name="home">
	{{> page}}
</template>

<template name="newsFeed">
	<div class="news-feed" id="news-feed">
		{{#if notFirst}}
			<div class="news-scroll ui attached segment" id="news-up">
				<i class="big up arrow icon"></i>
			</div>
		{{/if}}
		{{#each news}}
			{{> newsPost}}
		{{/each}}
		{{#if notLast}}
			<div class="news-scroll ui attached segment" id="news-down">
				<i class="big down arrow icon"></i>
			</div>
		{{/if}}
	</div>
</template>

<template name="sillyHighlight">
	<div class="silly-highlight ui segment">
		{{#with silly}}
			<h4>Latest Silly <small>{{title}}</small></h4>
			<a class="highlight-image" style="background-image:url({{cfsFileUrl 'default' file=getFile}});" href="{{pathFor 'sillies'}}"></a>
		{{/with}}
	</div>
</template>

<template name="news">
	<div class="news">
		{{#each news}}
			{{> newsPost}}
		{{/each}}
	</div>
</template>

<template name="newsPost">
	<div class="ui attached segment">
		{{#if isAdmin}}
			<div class="edit-buttons pull-right">
				<div id="btn-remove" class="btn btn-sm btn-danger">Remove</div>
			</div>
		{{/if}}

		<h4>{{timeAgo posted}} <small>by {{author}}</small></h4>
		<p>{{{newLineToBr content}}}</p>

		{{#if isAdmin}}
			<div id="confirm-modal" class="modal fade" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h4 class="modal-title">Remove</h4>
						</div>
						<div class="modal-body">
							<p>Are you sure you want to remove this news item?</p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							<button type="button" id="confirm-remove" class="btn btn-danger">Remove</button>
						</div>
					</div>
				</dic>
			</div>
		{{/if}}
	</div>
</template>

<template name="archive">
	<div class="ui segment">
		<h3>Stuff</h3>

		<div class="ui variable items">
			{{#each chapters}}
				{{> chapterArchive}}
			{{/each}}
		</div>
	</div>
</template>

<template name="chapterArchive">
	<a href="{{pathFor 'chapter'}}" class="item">
		<div class="ui rounded image">
			<img src='{{cfsFileUrl "thumb" file=getFile}}'>
		</div>
		<div class="content">
			<div class="meta">{{pluralize pageCount "page"}}</div>
			<div class="name">{{chapter}}. {{truncate title 28}}</div>
		</div>
	</a>
</template>

<template name="chapter">
	<div class="ui segment">
		<h3><a href="{{pathFor 'chapter'}}">
			Chapter {{chapter}}, {{title}}
		</a></h3>
		<span>{{pluralize pageCount "page"}}</span>

		<div class="ui variable items">
			{{#each pages}}
				{{> pageChapter}}
			{{/each}}
		</div>
	</div>
</template>

<template name="pageChapter">
	<a href="{{pathFor 'page'}}" class="item">
		<div class="ui rounded image">
			<img src='{{cfsFileUrl "thumb" file=getFile}}'>
		</div>
		<div class="content">
			<div class="name">{{#if eq page 0}}Cover{{else}}Page {{page}}{{/if}}</div>
		</div>
	</a>
</template>

<template name="page">
	<div class="page ui segment">
		<h3>
			<a href="{{pathFor 'chapter'}}">Chapter {{chapter}}</a>, {{#if eq page 0}}Cover{{else}}Page {{page}}{{/if}}
		</h3>
		<p>By {{author}}</p>
		<p>{{timeAgo posted}}</p>
		{{> arrows}}
		<img class="ui centered rounded image" src='{{cfsFileUrl "default" file=getFile}}'>

		<div class="ui horizontal icon divider">
			<i class="large dark comment icon"></i>
		</div>

		{{#constant}}
			{{> disqus}}
		{{/constant}}
	</div>
</template>

<template name="arrows">
	<div class="arrows unselectable">
		{{#if notFirst}}
			{{#with first}}
				<a href="{{pathFor 'page'}}"><i class="huge dark left double angle icon"></i></a>
			{{/with}}

			{{#with previous}}
				<a href="{{pathFor 'page'}}"><i class="arrow-margin huge dark left angle icon"></i></a>
			{{/with}}
		{{/if}}

		<a href="{{pathFor 'archive'}}" class="btn btn-default">Archive</a>

		{{#if notLast}}
			{{#with next}}
				<a href="{{pathFor 'page'}}"><i class="arrow-margin huge dark right angle icon"></i></a>
			{{/with}}

			{{#with last}}
				<a href="{{pathFor 'page'}}"><i class="huge dark right double angle icon"></i></a>
			{{/with}}
		{{/if}}
	</div>
</template>

<template name="sillyArrows">
	<div class="arrows unselectable">
		{{#if notFirst}}
			{{#with first}}
				<a href="{{pathFor 'sillies'}}"><i class="huge dark left double angle icon"></i></a>
			{{/with}}

			{{#with previous}}
				<a href="{{pathFor 'sillies'}}"><i class="arrow-margin huge dark left angle icon"></i></a>
			{{/with}}
		{{/if}}

		<a href="/sillies" class="btn btn-default">Sillies</a>

		{{#if notLast}}
			{{#with next}}
				<a href="{{pathFor 'sillies'}}"><i class="arrow-margin huge dark right angle icon"></i></a>
			{{/with}}

			{{#with last}}
				<a href="{{pathFor 'sillies'}}"><i class="huge dark right double angle icon"></i></a>
			{{/with}}
		{{/if}}
	</div>
</template>

<template name="sillies">
	<div class="ui segment">
		<h3>Sillies</h3>

		<div class="ui variable items">
			{{#each sillies}}
				{{> sillyItem}}
			{{/each}}
		</div>
	</div>
</template>

<template name="sillyItem">
	<a href="{{pathFor 'sillies'}}" class="item">
		<div class="ui rounded image">
			<img src='{{cfsFileUrl "square" file=getFile}}'>
		</div>
		<div class="content">
			<div class="name">Silly {{number}}</div>
		</div>
	</a>
</template>

<template name="silly">
	<div class="page ui segment">
		{{#if isAdmin}}
			<div class="edit-buttons pull-right">
				<a href="{{pathFor 'editSilly'}}" class="btn btn-primary">Edit</a>
			</div>
		{{/if}}

		<h3>Silly {{number}}: {{title}}</h3>
		<p>By {{author}}</p>
		<p>{{timeAgo posted}}</p>
		{{> sillyArrows}}

		<img class="ui centered rounded image" src='{{cfsFileUrl "default" file=getFile}}'>
	</div>
</template>

<template name="submit">
	{{> progressBar}}
	{{> submitChapter}}
	<br>
	{{#if isChapters}}
		{{> submitPage}}
	{{/if}}
	<br>
	{{> submitSilly}}
	<br>
	{{> submitNews}}
</template>

<template name="submitChapter">
	<form class="well submit-new form-horizontal" id="submit-page">
		<div class="form-group">
			<label class="form-label" for="chapter">New chapter</label>
			<select name="chapter" class="form-control">
				{{#each newChapters}}<option>{{this}}</option>{{/each}}
			</select>
		</div>

		<div class="form-group">
			<input name="title" type="text" value="" class="form-control" placeholder="chapter title">
		</div>

		<div class="form-group">
			<label for="file">Cover Image</label>
			<input type="file" name="file">
		</div>

		<div class="form-group">
			<input type="submit" value="Submit" class="btn btn-primary">
		</div>
	</form>
</template>

<template name="submitPage">
	<form class="well submit-new form-horizontal" id="submit-page">
		<div class="form-group">
			<label class="form-label" for="chapter">For chapter</label>
			<select name="chapter" class="form-control">
				{{#each chapters}}<option>{{chapter}} - {{title}}</option>{{/each}}
			</select>
		</div>

		<div class="form-group">
			<label for="file">Comic Image</label>
			<input type="file" name="file">
		</div>

		<div class="form-group">
			<input type="submit" value="Submit" class="btn btn-primary">
		</div>
	</form>
</template>

<template name="submitSilly">
	<form class="well submit-new form-horizontal" id="submit-silly">
		<div class="form-group">
			<input name="title" type="text" value="" class="form-control" placeholder="silly title">
		</div>

		<div class="form-group">
			<label for="file">Silly Image</label>
			<input type="file" name="file">
		</div>

		<div class="form-group">
			<input type="submit" value="Submit" class="btn btn-primary">
		</div>
	</form>
</template>

<template name="submitNews">
	<form class="well submit-new form-horizontal" id="submit-news">
		<div class="form-group">
			<textarea class="form-control" rows="5" name="content" placeholder="your news"></textarea>
		</div>

		<div class="form-group">
			<input type="submit" value="Submit" class="btn btn-primary">
		</div>
	</form>
</template>

<template name="edit">
	<div class="edit">
		<div class="options">
			<select name="chapter" class="form-control">
				{{#each selectChapters}}<option value="{{chapter}}">{{chapter}} - {{title}}</option>{{/each}}
			</select>

			<select name="page" class="form-control">
				<option>cover</option>
				{{#each selectPages}}<option value="{{page}}">{{page}}</option>{{/each}}
			</select>
		</div>

		{{yield 'edit'}}
	</div>
</template>

<template name="editPage">
	<div class="page well">
		{{> progressBar}}

		<div class="edit-buttons pull-right">
			<div id="btn-remove" class="unselectable btn btn-danger">Remove</div>
			<div id="btn-update" class="btn btn-primary">Update</div>
		</div>

		<h3>
			Edit: <a href="{{pathFor 'chapter'}}">Chapter {{chapter}}</a>, Page {{page}}
		</h3>
		<p>By {{author}}</p>
		<P>{{timeAgo posted}}</P>

		<div class="new-image">
			<label for="file-input">
				<div class="wrap">
					<p class="small text-center">click to change</p>
					<img class="editImage ui rounded image" src='{{cfsFileUrl "default" file=getFile}}'>
				</div>
			</label>

			<input id="file-input" type="file">
		</div>
	</div>

	<div id="confirm-modal" class="modal fade" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title">Remove</h4>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to remove Ch{{chapter}} Pg{{page}}?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" id="confirm-remove" class="btn btn-danger">Remove</button>
				</div>
			</div>
		</dic>
	</div>
</template>

<template name="editChapter">
	<div class="well">
		<div class="edit-buttons pull-right">
			<div id="btn-remove" class="unselectable btn btn-danger">Remove</div>
			<div id="btn-update" class="btn btn-primary">Update</div>
		</div>

		<h3>
			Chapter {{chapter}}, <span name="title" class="editable" data-type='text'>{{title}}</span>
		</h3>
		<span>{{pluralize pageCount "page"}}</span>

		<div class="new-image">
			<label for="file-input">
				<div class="wrap">
					<p class="small text-center">click to change</p>
					<img class="editImage ui rounded image" src='{{cfsFileUrl "default" file=getFile}}'>
				</div>
			</label>

			<input id="file-input" type="file">
		</div>
	</div>

	<div id="confirm-modal" class="modal fade" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title">Remove</h4>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to remove Chapter {{chapter}} and all of its pages?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" id="confirm-remove" class="btn btn-danger">Remove</button>
				</div>
			</div>
		</dic>
	</div>
</template>

<template name="editSilly">
	<div class="silly well">
		{{> progressBar}}

		<div class="edit-buttons pull-right">
			<div id="btn-remove" class="unselectable btn btn-danger">Remove</div>
			<div id="btn-update" class="btn btn-primary">Update</div>
		</div>

		<h3>Edit Silly {{number}}: <span name="title" class="editable" data-type='text'>{{title}}</span></h3>
		<p>By {{author}}</p>
		<P>{{timeAgo posted}}</P>

		<div class="new-image">
			<label for="file-input">
				<div class="wrap">
					<p class="small text-center">click to change</p>
					<img class="editImage ui rounded image" src='{{cfsFileUrl "default" file=getFile}}'>
				</div>
			</label>

			<input id="file-input" type="file">
		</div>
	</div>

	<div id="confirm-modal" class="modal fade" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title">Remove</h4>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to remove silly: {{number}} - {{title}}?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" id="confirm-remove" class="btn btn-danger">Remove</button>
				</div>
			</div>
		</dic>
	</div>
</template>

<template name="comments">
	<div class="ui minimal comments">
		<div class="comment">
			<a class="avatar">
				<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
			</a>
			<div class="content">
				<a class="author">Dog Doggington</a>
				<div class="metadata">
					<span class="date">2 days ago</span>
				</div>
				<div class="text">
					I think this is a great idea and i am voting on it
				</div>
				<div class="actions">
					<a class="reply">Reply</a>
					<a class="delete">Delete</a>
				</div>
			</div>
			<div class="comments">
				<div class="comment">
					<a class="avatar">
						<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
					</a>
					<div class="content">
						<a class="author">Pawfin Dog</a>
						<div class="metadata">
							<span class="date">1 day ago</span>
						</div>
						<div class="text">
							I think this is a great idea and i am voting on it
						</div>
						<div class="actions">
							<a class="reply">Reply</a>
							<a class="delete">Delete</a>
						</div>
					</div>
					<div class="comments">
						<div class="comment">
							<a class="avatar">
								<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
							</a>
							<div class="content">
								<a class="author">Dog Doggington</a>
								<div class="metadata">
									<span class="date">20 minutes ago</span>
								</div>
								<div class="text">
									I think this is a great idea and i am voting on it
								</div>
								<div class="actions">
									<a class="reply">Reply</a>
									<a class="delete">Delete</a>
								</div>
							</div>
						</div>
						<div class="comment">
							<a class="avatar">
								<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
							</a>
							<div class="content">
								<a class="author">Dog Doggington</a>
								<div class="metadata">
									<span class="date">20 minutes ago</span>
								</div>
								<div class="text">
									Also pizza.
								</div>
								<div class="actions">
									<a class="reply">Reply</a>
									<a class="delete">Delete</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="comment">
					<a class="avatar">
						<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
					</a>
					<div class="content">
						<a class="author">Dog Doggington</a>
						<div class="metadata">
							<span class="date">2 days ago</span>
						</div>
						<div class="text">
							I think this is a great idea and i am voting on it
						</div>
						<div class="actions">
							<a class="reply">Reply</a>
							<a class="delete">Delete</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="comment">
			<a class="avatar">
				<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
			</a>
			<div class="content">
				<a class="author">Dog Doggington</a>
				<div class="metadata">
					<span class="date">20 hours ago</span>
				</div>
				<div class="text">
					I think this is a great idea and i am voting on it
				</div>
				<div class="actions">
					<a class="reply">Reply</a>
				</div>
			</div>
		</div>
		<div class="comment">
			<a class="avatar">
				<img src="/cfs/images/ai6xHco4xtJxd6RMe_thumb.jpg">
			</a>
			<div class="content">
				<a class="author">Pawfin Dog</a>
				<div class="metadata">
					<span class="date">15 hours ago</span>
				</div>
				<div class="text">
					I think this is a great idea and i am voting on it
				</div>
				<div class="actions">
					<a class="reply">Reply</a>
				</div>
			</div>
		</div>
	</div>
</template>

<template name="disqus">
	<div id="disqus_thread"></div>
</template>
